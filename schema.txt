CREATE DATABASE IF NOT EXISTS LootDB;

USE LootDB;

CREATE TABLE SUBSCRIBER_ACCOUNT
(
  SubscriberID INT AUTO_INCREMENT NOT NULL,
  FName VARCHAR(50) NOT NULL,
  LName VARCHAR(50) NOT NULL,
  Username VARCHAR(30) NOT NULL,
  Password VARCHAR(255) NOT NULL,
  Birthday DATE NOT NULL,
  Email VARCHAR(100) NOT NULL,
  PhoneNumber VARCHAR(25),
  Joined TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (SubscriberID),
  UNIQUE (SubscriberID),
  UNIQUE (Username),
  UNIQUE (Email),
  UNIQUE (PhoneNumber)
);

CREATE TABLE EXTERNAL_ACCOUNT
(
  AccountID INT AUTO_INCREMENT NOT NULL,
  Bank VARCHAR(100) NOT NULL,
  AccountType VARCHAR(30) NOT NULL,
  CurrentBalance DECIMAL(15,2) NOT NULL DEFAULT 0.00,
  SyncStatus VARCHAR(30) NOT NULL,
  Currency CHAR(3) NOT NULL,
  SubscriberID INT NOT NULL,
  PRIMARY KEY (AccountID),
  FOREIGN KEY (SubscriberID) REFERENCES SUBSCRIBER_ACCOUNT(SubscriberID) ON DELETE CASCADE,
  UNIQUE (AccountID),
  CONSTRAINT CHECK_SyncStatus
  CHECK (SyncStatus in ("Active","Pending","Failed")),
  CONSTRAINT CHECK_AccountType
  CHECK (AccountType in ("Checking","Credit Card"))
  
);